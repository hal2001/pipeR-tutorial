<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Pipe for side effect | pipeR Tutorial</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.1">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../Pipe-operator/Pipe-with-assignment.html" />
    
    
    <link rel="prev" href="../Pipe-operator/Pipe-by-formula.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-katex/katex.min.css">
        
    
    

        
    <div class="book" data-level="2.4" data-basepath=".." data-revision="Mon Apr 06 2015 09:35:05 GMT+0800 (China Standard Time)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Getting-started/index.html">
            
                
                    <a href="../Getting-started/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Getting started
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="Getting-started/First-example.html">
            
                
                    <a href="../Getting-started/First-example.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        First example
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Getting-started/Design-principles.html">
            
                
                    <a href="../Getting-started/Design-principles.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Design principles
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Pipe-operator/index.html">
            
                
                    <a href="../Pipe-operator/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Pipe operator
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="Pipe-operator/Pipe-to-first-argument.html">
            
                
                    <a href="../Pipe-operator/Pipe-to-first-argument.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Pipe to first-argument
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="Pipe-operator/Pipe-to-dot.html">
            
                
                    <a href="../Pipe-operator/Pipe-to-dot.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Pipe to dot
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="Pipe-operator/Pipe-by-formula.html">
            
                
                    <a href="../Pipe-operator/Pipe-by-formula.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Pipe by formula
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="2.4" data-path="Pipe-operator/Pipe-for-side-effect.html">
            
                
                    <a href="../Pipe-operator/Pipe-for-side-effect.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Pipe for side effect
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="Pipe-operator/Pipe-with-assignment.html">
            
                
                    <a href="../Pipe-operator/Pipe-with-assignment.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Pipe with assignment
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="Pipe-operator/Extract-element.html">
            
                
                    <a href="../Pipe-operator/Extract-element.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Extract element
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Pipe-function/index.html">
            
                
                    <a href="../Pipe-function/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Pipe function
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="Pipe-function/Pipe-to-first-argument.html">
            
                
                    <a href="../Pipe-function/Pipe-to-first-argument.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Pipe to first-argument
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="Pipe-function/Dot-function.html">
            
                
                    <a href="../Pipe-function/Dot-function.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Dot function
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="Pipe-function/Subsetting.html">
            
                
                    <a href="../Pipe-function/Subsetting.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Subsetting
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="Pipeline/index.html">
            
                
                    <a href="../Pipeline/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Pipeline
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Pipeline/Argument.html">
            
                
                    <a href="../Pipeline/Argument.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Argument-based pipeline
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="Pipeline/Expression.html">
            
                
                    <a href="../Pipeline/Expression.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Expression-based pipeline
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Examples/index.html">
            
                
                    <a href="../Examples/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Examples
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="Examples/dplyr.html">
            
                
                    <a href="../Examples/dplyr.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        dplyr
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="Examples/rlist.html">
            
                
                    <a href="../Examples/rlist.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        rlist
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="Examples/rvest.html">
            
                
                    <a href="../Examples/rvest.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        rvest
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >pipeR Tutorial</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="pipe-for-side-effect">Pipe for side effect</h1>
<p>In a pipeline, one may be interested not only in the final outcome but sometimes also in intermediate results. In other words, as the operator pipes the value forward for streamlined processing, one may also want to save the intermediate result for further use, visualize the  intermediate values for better understanding, or print some message to indicate the progress.</p>
<p>However, if we directly call <code>plot()</code> or <code>cat()</code> in the middle of a pipeline, the pipeline will be broken because they return <code>NULL</code> or some other values undesired for further piping. </p>
<p>For example, we draw a scatter plot and saves its returned value to <code>z</code>.</p>
<pre><code class="lang-r">z &lt;- plot(mtcars$mpg)
</code></pre>
<p><img src="figure/simple-plot-1.png" title="plot of chunk simple-plot" alt="plot of chunk simple-plot" style="display: block; margin: auto;"></p>
<pre><code class="lang-r">z
</code></pre>
<pre><code># NULL
</code></pre><p>It can be clearly seen that <code>plot()</code> does two things: </p>
<ol>
<li>Draw a scatter image of <code>mtcars$mpg</code>.</li>
<li>Return <code>NULL</code> value.</li>
</ol>
<p>The first thing is often considered as <em>side-effect</em> because it is an influence the function has on the outside environment: it changes what to show in the graphics area. However, when we are building a pipeline and want to plot with some intermediate results, we only want the side effect and have to avoid the returned value, in this case, <code>NULL</code>, which is not the desired data we would like to further process.</p>
<h2 id="syntax-for-side-effect">Syntax for side effect</h2>
<p><code>%&gt;&gt;%</code> provides a syntax to supports side effect piping. The syntax is called <strong>one-sided formula</strong> that starts with <code>~</code> to indicate that the right-hand  side expression will be evaluated only for its side-effect, its value will be ignored, and the input value will be returned instead.</p>
<p>For example, after subsetting <code>mtcars</code> by lower and upper quantile, if we want to see how many rows are left, we can use a one-sided formula to indicate side-effect.</p>
<pre><code class="lang-r">mtcars %&gt;&gt;%
  subset(mpg &gt;= quantile(mpg, <span class="hljs-number">0.05</span>) &amp; mpg &lt;= quantile(mpg, <span class="hljs-number">0.95</span>),
    c(mpg, cyl, wt)) %&gt;&gt;%
  (~ cat(<span class="hljs-string">&quot;rows:&quot;</span>,nrow(.),<span class="hljs-string">&quot;\n&quot;</span>)) %&gt;&gt;%   <span class="hljs-comment"># cat() returns NULL</span>
  summary
</code></pre>
<pre><code># rows: 28
</code></pre><pre><code>#       mpg             cyl              wt       
#  Min.   :13.30   Min.   :4.000   Min.   :1.513  
#  1st Qu.:15.72   1st Qu.:4.000   1st Qu.:2.732  
#  Median :19.20   Median :6.000   Median :3.325  
#  Mean   :19.85   Mean   :6.214   Mean   :3.152  
#  3rd Qu.:21.82   3rd Qu.:8.000   3rd Qu.:3.570  
#  Max.   :30.40   Max.   :8.000   Max.   :5.345
</code></pre><p>To explain in detail, the syntax <code>(~ f(.))</code> tells the operator that <code>f(.)</code> on the right of <code>~</code> should only be evaluated for its side effect with <code>.</code> representing the input value, and the input value, i.e. the filtered <code>mtcars</code> should continue in the pipeline and be passed to <code>summary()</code>.</p>
<p>If <code>cat()</code> is directly called here, the code will not only fail because <code>%&gt;&gt;%</code> tries to pass the filtered data (a <code>data.frame</code>, which is essentially a <code>list</code>) to <code>cat()</code> and get rejected, but also become less readable because the data processing steps and side-effect steps are mixed to make it harder to distinguish really important lines.</p>
<pre><code class="lang-r">mtcars %&gt;&gt;%
  subset(mpg &gt;= quantile(mpg, <span class="hljs-number">0.05</span>) &amp; mpg &lt;= quantile(mpg, <span class="hljs-number">0.95</span>),
    c(mpg, cyl, wt)) %&gt;&gt;%
  cat(<span class="hljs-string">&quot;rows:&quot;</span>,nrow(.),<span class="hljs-string">&quot;\n&quot;</span>) %&gt;&gt;%   <span class="hljs-comment"># cat() returns NULL</span>
  summary
</code></pre>
<pre><code># Error in cat(list(...), file, sep, fill, labels, append): argument 1 (type &apos;list&apos;) cannot be handled by &apos;cat&apos;
</code></pre><p>If you look back at the correct code with the side effect syntax, you may find it more readable because you can easily distinguish side effect expressions with other lines.</p>
<p>The design of <code>~ expression</code> syntax for side effect also makes one-sided formula <strong>a branch</strong> of the mainstream pipeline. Note that the design always emphasizes the mainstream pipeline and makes it easy to find out branch pipelines.</p>
<p>Another example is plotting in the middle of a pipeline as side effect.</p>
<pre><code class="lang-r">mtcars %&gt;&gt;%
  subset(mpg &gt;= quantile(mpg, <span class="hljs-number">0.05</span>) &amp; mpg &lt;= quantile(mpg, <span class="hljs-number">0.95</span>)) %&gt;&gt;%
  (~ plot(mpg ~ wt, data = .)) %&gt;&gt;%    <span class="hljs-comment"># plot() returns NULL</span>
  lm(formula = mpg ~ wt) %&gt;&gt;%
  summary()
</code></pre>
<p><img src="figure/side-effect-graphics-1.png" title="plot of chunk side-effect-graphics" alt="plot of chunk side-effect-graphics" style="display: block; margin: auto;"></p>
<pre><code># 
# Call:
# lm(formula = mpg ~ wt, data = .)
# 
# Residuals:
#     Min      1Q  Median      3Q     Max 
# -3.9594 -1.7930 -0.2217  1.5782  5.6073 
# 
# Coefficients:
#             Estimate Std. Error t value Pr(&gt;|t|)    
# (Intercept)  35.3059     1.9850  17.786 4.49e-16 ***
# wt           -4.9043     0.6108  -8.029 1.65e-08 ***
# ---
# Signif. codes:  0 &apos;***&apos; 0.001 &apos;**&apos; 0.01 &apos;*&apos; 0.05 &apos;.&apos; 0.1 &apos; &apos; 1
# 
# Residual standard error: 2.563 on 26 degrees of freedom
# Multiple R-squared:  0.7126,    Adjusted R-squared:  0.7016 
# F-statistic: 64.47 on 1 and 26 DF,  p-value: 1.652e-08
</code></pre><p>With <code>~</code>, side-effect operations can be easily distinguished from mainstream pipeline, and the input value of each line can be easily found by skipping the lines that start with <code>(~</code> while you are looking back.</p>
<h2 id="lambda-expression">Lambda expression</h2>
<p>If you feel ambiguous when using <code>.</code> in the side-effect expression, you can write a formula after <code>~</code>. The expression can be either an expression using <code>.</code> or a formula (lambda expression) using user-defined symbol. Therefore the first example can be rewritten like</p>
<pre><code class="lang-r">mtcars %&gt;&gt;%
  subset(mpg &gt;= quantile(mpg, <span class="hljs-number">0.05</span>) &amp; mpg &lt;= quantile(mpg, <span class="hljs-number">0.95</span>),
    c(mpg, cyl, wt)) %&gt;&gt;%
  (~ filtered ~ cat(<span class="hljs-string">&quot;rows:&quot;</span>,nrow(filtered),<span class="hljs-string">&quot;\n&quot;</span>)) %&gt;&gt;%   <span class="hljs-comment"># cat() returns NULL</span>
  summary
</code></pre>
<pre><code># rows: 28
</code></pre><pre><code>#       mpg             cyl              wt       
#  Min.   :13.30   Min.   :4.000   Min.   :1.513  
#  1st Qu.:15.72   1st Qu.:4.000   1st Qu.:2.732  
#  Median :19.20   Median :6.000   Median :3.325  
#  Mean   :19.85   Mean   :6.214   Mean   :3.152  
#  3rd Qu.:21.82   3rd Qu.:8.000   3rd Qu.:3.570  
#  Max.   :30.40   Max.   :8.000   Max.   :5.345
</code></pre><h2 id="string">String</h2>
<p>The latest development version supports a feature to easily print a string in the middle of a pipeline. This feature can be used to indicate the step in which R is working on. For example,</p>
<pre><code class="lang-r">mtcars %&gt;&gt;%
  <span class="hljs-string">&quot;Running linear model&quot;</span> %&gt;&gt;%
  lm(formula = mpg ~ wt + cyl) %&gt;&gt;%
  <span class="hljs-string">&quot;Summarizing the model&quot;</span> %&gt;&gt;%
  summary %&gt;&gt;%
  coef
</code></pre>
<pre><code># Running linear model 
# Summarizing the model
</code></pre><pre><code>#              Estimate Std. Error   t value     Pr(&gt;|t|)
# (Intercept) 39.686261  1.7149840 23.140893 3.043182e-20
# wt          -3.190972  0.7569065 -4.215808 2.220200e-04
# cyl         -1.507795  0.4146883 -3.635972 1.064282e-03
</code></pre><p>For computationally heavy steps, we can insert strings like above to indicate the working progress of the pipeline. The computation in the above example apparently does not deserve such indication, the usage for a larger dataset can be helpful.</p>
<pre><code class="lang-r">data(diamonds, package = <span class="hljs-string">&quot;ggplot2&quot;</span>)
<span class="hljs-keyword">library</span>(pipeR)
<span class="hljs-keyword">library</span>(dplyr)

diamonds %&gt;&gt;%
  <span class="hljs-string">&quot;filtering data ...&quot;</span> %&gt;&gt;%
  filter(carat &gt;= quantile(carat, <span class="hljs-number">0.05</span>) &amp; carat &lt;= quantile(carat, <span class="hljs-number">0.95</span>)) %&gt;&gt;%
  <span class="hljs-string">&quot;selecting variables ...&quot;</span> %&gt;&gt;%
  select(carat, price, depth) %&gt;&gt;%
  <span class="hljs-string">&quot;estimating linear model ...&quot;</span> %&gt;&gt;%
  lm(formula = carat ~ price + depth) %&gt;&gt;%
  <span class="hljs-string">&quot;summarizing model ...&quot;</span> %&gt;&gt;%
  summary
</code></pre>
<h2 id="question-mark">Question mark</h2>
<p>An easier way to print the intermediate value is to use <code>(? expr)</code> syntax like asking a question. This also supports formula as lambda expression.</p>
<pre><code class="lang-r">mtcars %&gt;&gt;% 
  subset(vs == <span class="hljs-number">1</span>, c(mpg, cyl, wt)) %&gt;&gt;%
  (? nrow(.)) %&gt;&gt;%
  (? data ~ ncol(data)) %&gt;&gt;%
  summary
</code></pre>
<pre><code># ? nrow(.)
# [1] 14
# ? data ~ ncol(data)
# [1] 3
</code></pre><pre><code>#       mpg             cyl              wt       
#  Min.   :17.80   Min.   :4.000   Min.   :1.513  
#  1st Qu.:21.40   1st Qu.:4.000   1st Qu.:2.001  
#  Median :22.80   Median :4.000   Median :2.623  
#  Mean   :24.56   Mean   :4.571   Mean   :2.611  
#  3rd Qu.:29.62   3rd Qu.:5.500   3rd Qu.:3.209  
#  Max.   :33.90   Max.   :6.000   Max.   :3.460
</code></pre><p>However, in some cases, the output can be confusing if the same expression is evaluated at multiple places. For example,</p>
<pre><code class="lang-r">mtcars %&gt;&gt;% 
  (? nrow(.)) %&gt;&gt;%
  subset(vs == <span class="hljs-number">1</span>, c(mpg, cyl, wt)) %&gt;&gt;%
  (? nrow(.)) %&gt;&gt;%
  lm(formula = mpg ~ cyl + wt)
</code></pre>
<pre><code># ? nrow(.)
# [1] 32
# ? nrow(.)
# [1] 14
</code></pre><pre><code># 
# Call:
# lm(formula = mpg ~ cyl + wt, data = .)
# 
# Coefficients:
# (Intercept)          cyl           wt  
#     42.6573      -0.6388      -5.8132
</code></pre><p><code>nrow(.)</code> is evaluated both before and after subsetting <code>mtcars</code>. The short example may not be the worst situation, but the ambiguity can be eliminated by adding a string before <code>?</code>.</p>
<pre><code class="lang-r">mtcars %&gt;&gt;% 
  (<span class="hljs-string">&quot;Raw data rows:&quot;</span> ? nrow(.)) %&gt;&gt;%
  subset(vs == <span class="hljs-number">1</span>, c(mpg, cyl, wt)) %&gt;&gt;%
  (<span class="hljs-string">&quot;Filtered data rows:&quot;</span> ? nrow(.)) %&gt;&gt;%
  lm(formula = mpg ~ cyl + wt)
</code></pre>
<pre><code># ? Raw data rows: 
# [1] 32
# ? Filtered data rows: 
# [1] 14
</code></pre><pre><code># 
# Call:
# lm(formula = mpg ~ cyl + wt, data = .)
# 
# Coefficients:
# (Intercept)          cyl           wt  
#     42.6573      -0.6388      -5.8132
</code></pre><p>In the modified version above, we label each question expression by a string so that the output only prints the label instead, which makes it clearer to see what is printed below the question.</p>
<h2 id="stopping">Stopping</h2>
<p>Side effects are usually used on purpose not to influence the mainstream pipeline or workflow. But in some cases, such influence can be useful.</p>
<p>An example is stopping. If we call <code>stopifnot(...)</code> as side effect in the middle of a pipeline, we are actually trying to ensure a series of conditions. If any of the conditions does not hold, the evaluation will stop.</p>
<p>The following code build a linear model on <code>mtcars</code> and before making predictions, we insert a condition to check: if <span class="katex"><span class="katex-inner"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.853208em;vertical-align:-0.0391em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span><span class="mrel">&gt;</span><span class="mrel">=</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span></span> is violated, the pipeline will be terminated immediately.</p>
<p>In this particular case, the required <span class="katex"><span class="katex-inner"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span> is too low to be violated for this linear model.</p>
<pre><code class="lang-r">mtcars %&gt;&gt;% 
  subset(vs == <span class="hljs-number">1</span>, c(mpg, cyl, wt)) %&gt;&gt;%
  lm(formula = mpg ~ cyl + wt) %&gt;&gt;%
  (~ stopifnot(summary(.)$r.squared &gt;= <span class="hljs-number">0.5</span>)) %&gt;&gt;%
  predict(newdata = list(cyl = <span class="hljs-number">4.5</span>, wt  = <span class="hljs-number">3.0</span>))
</code></pre>
<pre><code>#        1 
# 22.34311
</code></pre><p>If we adjust the threshold to 0.8, the pipeline will be stopped before making predictions.</p>
<pre><code class="lang-r">mtcars %&gt;&gt;% 
  subset(vs == <span class="hljs-number">1</span>, c(mpg, cyl, wt)) %&gt;&gt;%
  lm(formula = mpg ~ cyl + wt) %&gt;&gt;%
  (~ stopifnot(summary(.)$r.squared &gt;= <span class="hljs-number">0.8</span>)) %&gt;&gt;%
  predict(newdata = list(cyl = <span class="hljs-number">4.5</span>, wt  = <span class="hljs-number">3.0</span>))
</code></pre>
<pre><code># Error: summary(.)$r.squared &gt;= 0.8 is not TRUE
</code></pre><h2 id="debugging">Debugging</h2>
<p>Another way to use side effect is debugging, which is more flexible than violently stopping the pipeline and gives you a chance to see what happens. If you want to go into debugging mode in the middle of a pipeline to inspect the environment interactively, you only have to insert <code>browser()</code> as a side-effect expression after the line you want to break.</p>
<p>For example, </p>
<pre><code class="lang-r">mtcars %&gt;&gt;% 
  subset(vs == <span class="hljs-number">1</span>, c(mpg, cyl, wt)) %&gt;&gt;%
  (~ browser()) %&gt;&gt;%
  lm(formula = mpg ~ cyl + wt) %&gt;&gt;%
  summary
</code></pre>
<p>The code will pause at <code>browser()</code> and go into interactive debugging mode.</p>
<pre><code>Called from: eval(expr, envir, enclos)
Browse[1]&gt; head(.)
                mpg cyl    wt
Datsun 710     22.8   4 2.320
Hornet 4 Drive 21.4   6 3.215
Valiant        18.1   6 3.460
Merc 240D      24.4   4 3.190
Merc 230       22.8   4 3.150
Merc 280       19.2   6 3.440
Browse[1]&gt;
</code></pre><p>In the mode, <code>.</code> represents the object being piped, and you can evaluate any expression you are interested in. To continue piping, just hit <code>&lt;Enter&gt;</code>.</p>
<p>If you want to distinguish different breakpoints, you can add <code>cat()</code> or <code>message()</code> ahead to show some message before getting paused.</p>
<pre><code class="lang-r">mtcars %&gt;&gt;% 
  subset(vs == <span class="hljs-number">1</span>, c(mpg, cyl, wt)) %&gt;&gt;%
  (~ message(<span class="hljs-string">&quot;debug1&quot;</span>)) %&gt;&gt;%
  (~ browser()) %&gt;&gt;%
  lm(formula = mpg ~ cyl + wt) %&gt;&gt;%
  summary
</code></pre>
<p>The code will pause after showing the message <code>debug1</code> as following:</p>
<pre><code>debug1
Called from: eval(expr, envir, enclos)
Browse[1]&gt;
</code></pre><p>In this way, you can easily find out which breakpoint is hit.</p>
<p>Since <code>browser()</code> supports conditional breakpoint with <code>expr =</code> being set, the breakpoint can be smart to examine the value of the expression and then decide whether or not to pause. For example,</p>
<pre><code class="lang-r">mtcars %&gt;&gt;% 
  subset(vs == <span class="hljs-number">1</span>, c(mpg, cyl, wt)) %&gt;&gt;%
  lm(formula = mpg ~ cyl + wt) %&gt;&gt;%
  summary %&gt;&gt;%
  (~ browser(expr = .$r.squared &lt; <span class="hljs-number">0.8</span>))
</code></pre>
<p>If the <span class="katex"><span class="katex-inner"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span> of the linear model is less than 0.8, the evaluation will pause and wait for browser. You can adjust the threshold at anytime to any value you think indicating a problem.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../Pipe-operator/Pipe-by-formula.html" class="navigation navigation-prev " aria-label="Previous page: Pipe by formula"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../Pipe-operator/Pipe-with-assignment.html" class="navigation navigation-next " aria-label="Next page: Pipe with assignment"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"ga":{"token":"UA-47159422-1","configuration":"auto"}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-47159422-1', 'auto');ga('send', 'pageview');</script>
    </body>
    
</html>
